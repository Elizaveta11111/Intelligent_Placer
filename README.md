# Постановка задачи
На вход алгоритму подается фотография на которой находится некоторое количество заранее известных и фиксированных предметов и лист А4 с изображением многоугольника, расположенных на светлой горизонтальной поверхности.

Так же алгоритм имеет доступ к
- фотографии поверхности на которой расположены предметы и лист с многоугольником
- снимкам десяти предметов, которые будут находиться на входных фотографиях, на белом листе А4

Требования к предметам:
- предметы не должны перекрывать друг друга 
- предметы должны быть повернуты к камере так же, как и на отдельных снимках
- на фотографии не могут отсутствовать предметы
- на одной фотографии не может быть двух одинаковых предметов
- предметы расположены на фотографии целиком
- предметы не пересекаются с листом, на котором изображен многоугольник

Требования к многоугольнику:
- многоугольник должен быть простым, число углов многоугольника не должно быть больше 10
- многоугольник должен быть нарисован темным маркером на белом листе, линия должна быть ровной и не иметь разрывов, не быть тоньше 0.5мм и шире 5мм
- не рисовать на листе что-то вместо или кроме многоугольника
- если предметы можно разместить в многоугольнике, то расстояние между предметами в этом размещении и от предметов до границ многоугольника должно быть больше 3 мм.

Требования к поверхности:
- однотонная
- на ней должны хорошо выделяться предметы и границы листа бумаги
- на ней не должны присутсвовать посторонние предметы

Требования к фотографиям:
- высота съемки 30-50 см
- камера должна быть расположена перпендикулярно к поверхности и наклонена не более чем на 10 градусов
- отсутствие пересвеченных и серо-черных областей
- разрешение выше чем 1280x720 px

Результат работы программы - True если предметы на фото можно разместить в заданном многоугольнике и False если нельзя.
# Набор данных
[Фотографии предметов](https://github.com/Elizaveta11111/Intelligent_Placer/tree/main/objects)  
[Входные данные](https://github.com/Elizaveta11111/Intelligent_Placer/tree/main/input)  
Примеры входных фотографий: 
![Фотография 1.](https://github.com/Elizaveta11111/Intelligent_Placer/blob/main/input/1.jpg?raw=true)  
Случай True на одном предмете  
![Фотография 8.](https://github.com/Elizaveta11111/Intelligent_Placer/blob/main/input/8.jpg?raw=true)   
Случай False на одном предмете  
![Фотография 16.](https://github.com/Elizaveta11111/Intelligent_Placer/blob/main/input/16.jpg?raw=true)  
Случай True со сложным многоугольником.  
![Фотография 17.](https://github.com/Elizaveta11111/Intelligent_Placer/blob/main/input/17.jpg?raw=true)  
Случай True на двух предметах  
![Фотография 21.](https://github.com/Elizaveta11111/Intelligent_Placer/blob/main/input/21.jpg?raw=true)  
Случай False со сложным многоугольником.  
![Фотография 24.](https://github.com/Elizaveta11111/Intelligent_Placer/blob/main/input/24.jpg?raw=true) 
Случай когда три предмета могут быть расположенны единственным образом.  
![Фотография 26.](https://github.com/Elizaveta11111/Intelligent_Placer/blob/main/input/26.jpg?raw=true) 
Случай когда можно расположить в многоугольнике большое количество предметов. 

# План решения задачи
### Распознование многоугольника
Выделим лист с многоугольником на изображении с помощью бинаризации. Кроме него на маске присутствуют только шумы, поэтому выделив две наибольшие компоненты связности можем отделить лист и многоугольник. Применим морфологичексие операции, чтобы избавиться от шумов и линии маркера на листе.  
Далее найдем вершины листа и многоугольника с помощью OpenCV.  
Теперь необходимо определить координаты многоугольника относительно листа. Для этого найдем афинное преобразование, которое преводит координаты нижнего левого угла листа на фото в естесственный масштаб. Угол на фото необходимо выбрать так, чтобы стороны угла образовывали правую тройку векторов с осью z. Определить ориентацию можно вычислив направление векторного произведения, при этом достаточно знать только последнюю компоненту так как оно определяет знак по оси z. В конце применим найденное преобразование к многоугольнику.
### Распознование предметов
1. Вычесть из изображения фон и удалить пиксели листа с многоугольником. 
2. Избавиться от шумов, выделить компоненты связности.
3. Для каждой компоненты, определить минимальный ограничивающий прямоугольник.
4. Далее можно определить предмет, расположенный в многоугольнике по совокупности параметров: длинна и ширина, цвет, площадь.
### Размещение предметов
Так как предметы заранее известны, запишем в коде программы коорднаты многоугольников, которыми можно их ограничить. После того как узнаем какие предметы находятся на фото и получим многоугольник будем решать задачу размещения этих ограничивающих предметы многоугольников.  
Так же заранее определим порядок размещения предметов - первыми будем пытаться разместить наибольшие по размерам. К тому же будем размещать предметы по краям многоугольника.  
Алгоритм размещения одного предмета:
1. Распологаем предмет так, чтобы одна из его вершин была в начале координат, а строна расположена на оси x.
2. Распологаем многоугольник таким же образом.
3. Если предмет лежит вне многоугольника, сдвигаем его вправо, пока он не окажется за ближайшей стороной.
4. Если предмет снова оказался вне многоугольника, то считаем что в данном случае предмет разместить нельзя.
5. Перебираем все варианты расположения предмета и многоугольника, в итоге получим список возможных размещений.

Далее для каждого полученного варианта получим новый многоугольник, убрав из старого занятую предметом часть, следущим образом:  
1. Выберем сторону многоугольника, на которой нет вершин предмета.
2. Идем по часовой стреке по сторонам многоугольника, пока не встретим сторону на которой лежит вершина. Тоже самое проделаем в обратном направлении.
3. Рассмотрим одну из найденных на предыдущем шаге вершин. Будем двигаться из нее по сторонам предмета пока не достигнем второй найденной точки. При этом у нас будет два варианта выбора направления обхода. Выберем то, для которого меньше угол между последней посещенной стороной многоугольника и следующей за ней стороной предмета.
4. Все посещенные точки образуют искомый многоугольник. 
5. При различных начальных сторонах получим несколько таких многоугольников, поэтому выберем наибольший по площади.
  
Поверяем, что площадь полученного многоугольника больше суммарной площади неразмещенных предметов.  
Таким образом переберем все варианты. Перебор может оказаться достаточно большим в случае отрицательного ответа, так что нужно рассмотреть возможные стратегии его сокращения, например распологать предметы только рядом друг с другом, либо выбирать на каждом шаге оптимальное по площади размещение.